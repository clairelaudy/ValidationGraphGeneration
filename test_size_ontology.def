Bootstrap: docker
From: ubuntu:24.04

%files
    src /ValidationGraphGeneration
    bin /ValidationGraphGeneration
    input /ValidationGraphGeneration
    pyproject.toml /ValidationGraphGeneration

%post
    # Update the available packages list.
    apt -y update
    # And add the "universe" repository (allow to install many more software).
    apt -y install software-properties-common time
    # add-apt-repository universe
    # apt -y update
    # Update the operating systems (install last versions with bugfixes).
    # apt -y dist-upgrade

    # Install dependencies for your project.
    apt -y install git curl python3 bash wget openjdk-11-jre
    curl -LsSf https://astral.sh/uv/install.sh | sh

    echo "export PATH=/root/.local/bin:\$PATH" >> $APPTAINER_ENVIRONMENT

    # Download something.
    cd /
    # git clone --branch main --single-branch --recurse-submodules https://github.com/clairelaudy/ValidationGraphGeneration

    mkdir -p /output/
    chmod -R a+rw /output/

    # Clean-up of the APT cache (will lighten the container).
    # apt -y purge software-properties-common curl
    # apt -y --purge autoremove
    # apt -y autoclean
    # apt clean

    cd /ValidationGraphGeneration/
    UV_PROJECT_ENVIRONMENT=$(pwd)/.venv /root/.local/bin/uv sync --no-cache

    cd /root/.local/bin/
    wget https://github.com/ontodev/robot/releases/download/v1.9.8/robot.jar
    wget https://raw.githubusercontent.com/ontodev/robot/master/bin/robot
    chmod a+x ./robot

%environment
    export PATH="$PATH:/root/.local/bin:/ValidationGraphGeneration/bin"
    export UV_CACHE_DIR=/tmp/uv_cache

%runscript
    cd /output/
    test_size_ontology.sh $*

%labels
    Author Claire Laudy
    Author Johann Dreo
